<div class="section" id="extending-nikola">
<h1><a class="toc-backref" href="#id1">Extending Nikola</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field"><th class="field-name">Version:</th><td class="field-body">v7.7.6</td>
</tr>
<tr class="field"><th class="field-name">Author:</th><td class="field-body">Roberto Alsina &lt;<a class="reference external" href="mailto:ralsina&#64;netmanagers.com.ar">ralsina&#64;netmanagers.com.ar</a>&gt;</td>
</tr>
</tbody>
</table>
<div class="contents alert alert-info pull-right topic" id="contents">
<p class="topic-title first">Contents</p>
<ul class="simple">
<li><a class="reference internal" href="#extending-nikola" id="id1">Extending Nikola</a><ul>
<li><a class="reference internal" href="#command-plugins" id="id2">Command Plugins</a></li>
<li><a class="reference internal" href="#templatesystem-plugins" id="id3">TemplateSystem Plugins</a></li>
<li><a class="reference internal" href="#task-plugins" id="id4">Task Plugins</a></li>
<li><a class="reference internal" href="#pagecompiler-plugins" id="id5">PageCompiler Plugins</a></li>
<li><a class="reference internal" href="#restextension-plugins" id="id6">RestExtension Plugins</a></li>
<li><a class="reference internal" href="#markdownextension-plugins" id="id7">MarkdownExtension Plugins</a></li>
<li><a class="reference internal" href="#signalhandler-plugins" id="id8">SignalHandler Plugins</a></li>
<li><a class="reference internal" href="#configplugin-plugins" id="id9">ConfigPlugin Plugins</a></li>
<li><a class="reference internal" href="#postscanner-plugins" id="id10">PostScanner Plugins</a></li>
</ul>
</li>
<li><a class="reference internal" href="#plugin-index" id="id11">Plugin Index</a></li>
<li><a class="reference internal" href="#path-link-resolution-mechanism" id="id12">Path/Link Resolution Mechanism</a></li>
<li><a class="reference internal" href="#template-hooks" id="id13">Template Hooks</a></li>
<li><a class="reference internal" href="#shortcodes" id="id14">Shortcodes</a></li>
<li><a class="reference internal" href="#state-and-cache" id="id15">State and Cache</a></li>
</ul>
</div>
<p class="lead">Nikola is extensible. Almost all its functionality is based on plugins,
and you can add your own or replace the provided ones.</p>
<p>Plugins consist of a metadata file (with <tt class="docutils literal">.plugin</tt> extension) and
a Python module (a <tt class="docutils literal">.py</tt> file) or package (a folder containing
a <tt class="docutils literal">__init__.py</tt> file.</p>
<p>To use a plugin in your site, you just have to put it in a <tt class="docutils literal">plugins</tt>
folder in your site.</p>
<p>Plugins come in various flavours, aimed at extending different aspects
of Nikola.</p>
<div class="section" id="command-plugins">
<h2><a class="toc-backref" href="#id2">Command Plugins</a></h2>
<p>When you run <tt class="docutils literal">nikola <span class="pre">--help</span></tt> you will see something like this:</p>
<pre class="code console"><a name="rest_code_c687914fafd049118436d17af8c86ebd-1"></a><span class="gp">$</span> nikola <span class="nb">help</span>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-2"></a><span class="go">Nikola is a tool to create static websites and blogs. For full documentation and more</span>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-3"></a><span class="go">information, please visit https://getnikola.com/</span>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-4"></a>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-5"></a>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-6"></a><span class="go">Available commands:</span>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-7"></a><span class="go">nikola auto                 automatically detect site changes, rebuild</span>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-8"></a><span class="go">                            and optionally refresh a browser</span>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-9"></a><span class="go">nikola bootswatch_theme     given a swatch name from bootswatch.com and a</span>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-10"></a><span class="go">                            parent theme, creates a custom theme</span>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-11"></a><span class="go">nikola build                run tasks</span>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-12"></a><span class="go">nikola check                check links and files in the generated site</span>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-13"></a><span class="go">nikola clean                clean action / remove targets</span>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-14"></a><span class="go">nikola console              start an interactive python console with access to</span>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-15"></a><span class="go">                            your site and configuration</span>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-16"></a><span class="go">nikola deploy               deploy the site</span>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-17"></a><span class="go">nikola dumpdb               dump dependency DB</span>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-18"></a><span class="go">nikola forget               clear successful run status from internal DB</span>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-19"></a><span class="go">nikola help                 show help</span>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-20"></a><span class="go">nikola ignore               ignore task (skip) on subsequent runs</span>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-21"></a><span class="go">nikola import_blogger       import a blogger dump</span>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-22"></a><span class="go">nikola import_feed          import a RSS/Atom dump</span>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-23"></a><span class="go">nikola import_wordpress     import a WordPress dump</span>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-24"></a><span class="go">nikola init                 create a Nikola site in the specified folder</span>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-25"></a><span class="go">nikola list                 list tasks from dodo file</span>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-26"></a><span class="go">nikola mincss               apply mincss to the generated site</span>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-27"></a><span class="go">nikola new_post             create a new blog post or site page</span>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-28"></a><span class="go">nikola run                  run tasks</span>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-29"></a><span class="go">nikola serve                start the test webserver</span>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-30"></a><span class="go">nikola strace               use strace to list file_deps and targets</span>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-31"></a><span class="go">nikola theme                manage themes</span>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-32"></a><span class="go">nikola version              print the Nikola version number</span>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-33"></a>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-34"></a><span class="go">nikola help                 show help / reference</span>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-35"></a><span class="go">nikola help &lt;command&gt;       show command usage</span>
<a name="rest_code_c687914fafd049118436d17af8c86ebd-36"></a><span class="go">nikola help &lt;task-name&gt;     show task usage</span>
</pre><p>That will give you a list of all available commands in your version of Nikola.
Each and every one of those is a plugin. Let's look at a typical example:</p>
<p>First, the <tt class="docutils literal">serve.plugin</tt> file:</p>
<pre class="code ini"><a name="rest_code_efedb6659cdd402598f693f68141fc4f-1"></a><span class="k">[Core]</span>
<a name="rest_code_efedb6659cdd402598f693f68141fc4f-2"></a><span class="na">Name</span> <span class="o">=</span> <span class="s">serve</span>
<a name="rest_code_efedb6659cdd402598f693f68141fc4f-3"></a><span class="na">Module</span> <span class="o">=</span> <span class="s">serve</span>
<a name="rest_code_efedb6659cdd402598f693f68141fc4f-4"></a>
<a name="rest_code_efedb6659cdd402598f693f68141fc4f-5"></a><span class="k">[Documentation]</span>
<a name="rest_code_efedb6659cdd402598f693f68141fc4f-6"></a><span class="na">Author</span> <span class="o">=</span> <span class="s">Roberto Alsina</span>
<a name="rest_code_efedb6659cdd402598f693f68141fc4f-7"></a><span class="na">Version</span> <span class="o">=</span> <span class="s">0.1</span>
<a name="rest_code_efedb6659cdd402598f693f68141fc4f-8"></a><span class="na">Website</span> <span class="o">=</span> <span class="s">https://getnikola.com</span>
<a name="rest_code_efedb6659cdd402598f693f68141fc4f-9"></a><span class="na">Description</span> <span class="o">=</span> <span class="s">Start test server.</span>
</pre><div class="note">
<p class="first admonition-title">Note</p>
<p class="last">If you want to publish your plugin on the Plugin Index, <a class="reference external" href="https://github.com/getnikola/plugins/blob/master/README.md">read
the docs for the Index</a>
(and the .plugin file examples and explanations).</p>
</div>
<p>For your own plugin, just change the values in a sensible way. The
<tt class="docutils literal">Module</tt> will be used to find the matching Python module, in this case
<tt class="docutils literal">serve.py</tt>, from which this is the interesting bit:</p>
<pre class="code python"><a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-1"></a><span class="kn">from</span> <span class="nn">nikola.plugin_categories</span> <span class="kn">import</span> <span class="n">Command</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-2"></a>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-3"></a><span class="c"># You have to inherit Command for this to be a</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-4"></a><span class="c"># command plugin:</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-5"></a>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-6"></a><span class="k">class</span> <span class="nc">CommandServe</span><span class="p">(</span><span class="n">Command</span><span class="p">):</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-7"></a>    <span class="sd">&quot;&quot;&quot;Start test server.&quot;&quot;&quot;</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-8"></a>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-9"></a>    <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;serve&quot;</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-10"></a>    <span class="n">doc_usage</span> <span class="o">=</span> <span class="s">&quot;[options]&quot;</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-11"></a>    <span class="n">doc_purpose</span> <span class="o">=</span> <span class="s">&quot;start the test webserver&quot;</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-12"></a>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-13"></a>    <span class="n">cmd_options</span> <span class="o">=</span> <span class="p">(</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-14"></a>        <span class="p">{</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-15"></a>            <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;port&#39;</span><span class="p">,</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-16"></a>            <span class="s">&#39;short&#39;</span><span class="p">:</span> <span class="s">&#39;p&#39;</span><span class="p">,</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-17"></a>            <span class="s">&#39;long&#39;</span><span class="p">:</span> <span class="s">&#39;port&#39;</span><span class="p">,</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-18"></a>            <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="mi">8000</span><span class="p">,</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-19"></a>            <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-20"></a>            <span class="s">&#39;help&#39;</span><span class="p">:</span> <span class="s">&#39;Port number (default: 8000)&#39;</span><span class="p">,</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-21"></a>        <span class="p">},</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-22"></a>        <span class="p">{</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-23"></a>            <span class="s">&#39;name&#39;</span><span class="p">:</span> <span class="s">&#39;address&#39;</span><span class="p">,</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-24"></a>            <span class="s">&#39;short&#39;</span><span class="p">:</span> <span class="s">&#39;a&#39;</span><span class="p">,</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-25"></a>            <span class="s">&#39;long&#39;</span><span class="p">:</span> <span class="s">&#39;--address&#39;</span><span class="p">,</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-26"></a>            <span class="s">&#39;type&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-27"></a>            <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="s">&#39;127.0.0.1&#39;</span><span class="p">,</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-28"></a>            <span class="s">&#39;help&#39;</span><span class="p">:</span> <span class="s">&#39;Address to bind (default: 127.0.0.1)&#39;</span><span class="p">,</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-29"></a>        <span class="p">},</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-30"></a>    <span class="p">)</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-31"></a>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-32"></a>    <span class="k">def</span> <span class="nf">_execute</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-33"></a>        <span class="sd">&quot;&quot;&quot;Start test server.&quot;&quot;&quot;</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-34"></a>        <span class="n">out_dir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;OUTPUT_FOLDER&#39;</span><span class="p">]</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-35"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">out_dir</span><span class="p">):</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-36"></a>            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Error: Missing &#39;{0}&#39; folder?&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">out_dir</span><span class="p">))</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-37"></a>        <span class="k">else</span><span class="p">:</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-38"></a>            <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">out_dir</span><span class="p">)</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-39"></a>            <span class="n">httpd</span> <span class="o">=</span> <span class="n">HTTPServer</span><span class="p">((</span><span class="n">options</span><span class="p">[</span><span class="s">&#39;address&#39;</span><span class="p">],</span> <span class="n">options</span><span class="p">[</span><span class="s">&#39;port&#39;</span><span class="p">]),</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-40"></a>                            <span class="n">OurHTTPRequestHandler</span><span class="p">)</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-41"></a>            <span class="n">sa</span> <span class="o">=</span> <span class="n">httpd</span><span class="o">.</span><span class="n">socket</span><span class="o">.</span><span class="n">getsockname</span><span class="p">()</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-42"></a>            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Serving HTTP on&quot;</span><span class="p">,</span> <span class="n">sa</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s">&quot;port&quot;</span><span class="p">,</span> <span class="n">sa</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s">&quot;...&quot;</span><span class="p">)</span>
<a name="rest_code_fe8fda63a37a42a6980c3da9a5ee9008-43"></a>            <span class="n">httpd</span><span class="o">.</span><span class="n">serve_forever</span><span class="p">()</span>
</pre><p>As mentioned above, a plugin can have options, which the user can see by doing
<tt class="docutils literal">nikola help command</tt> and can later use, for example:</p>
<pre class="code console"><a name="rest_code_72aea214dfb04814aa29310526eb8b49-1"></a><span class="gp">$</span> nikola <span class="nb">help </span>serve
<a name="rest_code_72aea214dfb04814aa29310526eb8b49-2"></a><span class="go">Purpose: start the test webserver</span>
<a name="rest_code_72aea214dfb04814aa29310526eb8b49-3"></a><span class="go">Usage:   nikola serve [options]</span>
<a name="rest_code_72aea214dfb04814aa29310526eb8b49-4"></a>
<a name="rest_code_72aea214dfb04814aa29310526eb8b49-5"></a><span class="go">Options:</span>
<a name="rest_code_72aea214dfb04814aa29310526eb8b49-6"></a><span class="go">-p ARG, --port=ARG        Port number (default: 8000)</span>
<a name="rest_code_72aea214dfb04814aa29310526eb8b49-7"></a><span class="go">-a ARG, ----address=ARG   Address to bind (default: 127.0.0.1)</span>
<a name="rest_code_72aea214dfb04814aa29310526eb8b49-8"></a>
<a name="rest_code_72aea214dfb04814aa29310526eb8b49-9"></a><span class="gp">$</span> nikola serve -p 9000
<a name="rest_code_72aea214dfb04814aa29310526eb8b49-10"></a><span class="go">Serving HTTP on 127.0.0.1 port 9000 ...</span>
</pre><p>So, what can you do with commands? Well, anything you want, really. I have implemented
a sort of planet using it. So, be creative, and if you do something interesting,
let me know ;-)</p>
</div>
<div class="section" id="templatesystem-plugins">
<h2><a class="toc-backref" href="#id3">TemplateSystem Plugins</a></h2>
<p>Nikola supports Mako and Jinja2. If you prefer some other templating
system, then you will have to write a <tt class="docutils literal">TemplateSystem</tt> plugin. Here's how they work.
First, you have to create a <tt class="docutils literal">.plugin</tt> file. Here's the one for the Mako plugin:</p>
<pre class="code ini"><a name="rest_code_ae1b8e2618f2457f8fb7c281827e3c1f-1"></a><span class="k">[Core]</span>
<a name="rest_code_ae1b8e2618f2457f8fb7c281827e3c1f-2"></a><span class="na">Name</span> <span class="o">=</span> <span class="s">mako</span>
<a name="rest_code_ae1b8e2618f2457f8fb7c281827e3c1f-3"></a><span class="na">Module</span> <span class="o">=</span> <span class="s">mako</span>
<a name="rest_code_ae1b8e2618f2457f8fb7c281827e3c1f-4"></a>
<a name="rest_code_ae1b8e2618f2457f8fb7c281827e3c1f-5"></a><span class="k">[Documentation]</span>
<a name="rest_code_ae1b8e2618f2457f8fb7c281827e3c1f-6"></a><span class="na">Author</span> <span class="o">=</span> <span class="s">Roberto Alsina</span>
<a name="rest_code_ae1b8e2618f2457f8fb7c281827e3c1f-7"></a><span class="na">Version</span> <span class="o">=</span> <span class="s">0.1</span>
<a name="rest_code_ae1b8e2618f2457f8fb7c281827e3c1f-8"></a><span class="na">Website</span> <span class="o">=</span> <span class="s">https://getnikola.com</span>
<a name="rest_code_ae1b8e2618f2457f8fb7c281827e3c1f-9"></a><span class="na">Description</span> <span class="o">=</span> <span class="s">Support for Mako templates.</span>
</pre><div class="note">
<p class="first admonition-title">Note</p>
<p class="last">If you want to publish your plugin on the Plugin Index, <a class="reference external" href="https://github.com/getnikola/plugins/blob/master/README.md">read
the docs for the Index</a>
(and the .plugin file examples and explanations).</p>
</div>
<p>You will have to replace &quot;mako&quot; with your template system's name, and other data
in the obvious ways.</p>
<p>The &quot;Module&quot; option is the name of the module, which has to look something like this,
a stub for a hypothetical system called &quot;Templater&quot;:</p>
<pre class="code python"><a name="rest_code_c2edebbef05a45a78844180ed582625e-1"></a><span class="kn">from</span> <span class="nn">nikola.plugin_categories</span> <span class="kn">import</span> <span class="n">TemplateSystem</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-2"></a>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-3"></a><span class="c"># You have to inherit TemplateSystem</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-4"></a>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-5"></a><span class="k">class</span> <span class="nc">TemplaterTemplates</span><span class="p">(</span><span class="n">TemplateSystem</span><span class="p">):</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-6"></a>    <span class="sd">&quot;&quot;&quot;Wrapper for Templater templates.&quot;&quot;&quot;</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-7"></a>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-8"></a>    <span class="c"># name has to match Name in the .plugin file</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-9"></a>    <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;templater&quot;</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-10"></a>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-11"></a>    <span class="c"># A list of directories where the templates will be</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-12"></a>    <span class="c"># located. Most template systems have some sort of</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-13"></a>    <span class="c"># template loading tool that can use this.</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-14"></a>    <span class="k">def</span> <span class="nf">set_directories</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directories</span><span class="p">,</span> <span class="n">cache_folder</span><span class="p">):</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-15"></a>        <span class="sd">&quot;&quot;&quot;Sets the list of folders where templates are located and cache.&quot;&quot;&quot;</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-16"></a>        <span class="k">pass</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-17"></a>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-18"></a>    <span class="c"># You *must* implement this, even if to return []</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-19"></a>    <span class="c"># It should return a list of all the files that,</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-20"></a>    <span class="c"># when changed, may affect the template&#39;s output.</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-21"></a>    <span class="c"># usually this involves template inheritance and</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-22"></a>    <span class="c"># inclusion.</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-23"></a>    <span class="k">def</span> <span class="nf">template_deps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_name</span><span class="p">):</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-24"></a>        <span class="sd">&quot;&quot;&quot;Returns filenames which are dependencies for a template.&quot;&quot;&quot;</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-25"></a>        <span class="k">return</span> <span class="p">[]</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-26"></a>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-27"></a>    <span class="k">def</span> <span class="nf">render_template</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template_name</span><span class="p">,</span> <span class="n">output_name</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-28"></a>        <span class="sd">&quot;&quot;&quot;Renders template to a file using context.</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-29"></a>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-30"></a><span class="sd">        This must save the data to output_name *and* return it</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-31"></a><span class="sd">        so that the caller may do additional processing.</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-32"></a><span class="sd">        &quot;&quot;&quot;</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-33"></a>        <span class="k">pass</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-34"></a>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-35"></a>    <span class="c"># The method that does the actual rendering.</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-36"></a>    <span class="c"># template_name is the name of the template file,</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-37"></a>    <span class="c"># context is a dictionary containing the data the template</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-38"></a>    <span class="c"># uses for rendering.</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-39"></a>    <span class="k">def</span> <span class="nf">render_template_to_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">template</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-40"></a>        <span class="sd">&quot;&quot;&quot;Renders template to a string using context. &quot;&quot;&quot;</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-41"></a>        <span class="k">pass</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-42"></a>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-43"></a>    <span class="k">def</span> <span class="nf">inject_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">directory</span><span class="p">):</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-44"></a>        <span class="sd">&quot;&quot;&quot;Injects the directory with the lowest priority in the</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-45"></a><span class="sd">        template search mechanism.&quot;&quot;&quot;</span>
<a name="rest_code_c2edebbef05a45a78844180ed582625e-46"></a>        <span class="k">pass</span>
</pre><p>You can see a real example in <a class="reference external" href="https://github.com/getnikola/nikola/blob/master/nikola/plugins/template/jinja.py">the Jinja plugin</a></p>
</div>
<div class="section" id="task-plugins">
<h2><a class="toc-backref" href="#id4">Task Plugins</a></h2>
<p>If you want to do something that depends on the data in your site, you
probably want to do a <tt class="docutils literal">Task</tt> plugin, which will make it be part of the
<tt class="docutils literal">nikola build</tt> command. These are the currently available tasks, all
provided by plugins:</p>
<div class="sidebar">
<p class="first sidebar-title">Other Tasks</p>
<p class="last">There are also <tt class="docutils literal">LateTask</tt> plugins, which are executed later,
and <tt class="docutils literal">TaskMultiplier</tt> plugins that take a task and create
more tasks out of it.</p>
</div>
<pre class="code console"><a name="rest_code_005d96b686bc42ee8319efdfc9685c1f-1"></a><span class="gp">$</span> nikola list
<a name="rest_code_005d96b686bc42ee8319efdfc9685c1f-2"></a><span class="go">Scanning posts....done!</span>
<a name="rest_code_005d96b686bc42ee8319efdfc9685c1f-3"></a><span class="go">build_bundles</span>
<a name="rest_code_005d96b686bc42ee8319efdfc9685c1f-4"></a><span class="go">build_less</span>
<a name="rest_code_005d96b686bc42ee8319efdfc9685c1f-5"></a><span class="go">copy_assets</span>
<a name="rest_code_005d96b686bc42ee8319efdfc9685c1f-6"></a><span class="go">copy_files</span>
<a name="rest_code_005d96b686bc42ee8319efdfc9685c1f-7"></a><span class="go">post_render</span>
<a name="rest_code_005d96b686bc42ee8319efdfc9685c1f-8"></a><span class="go">redirect</span>
<a name="rest_code_005d96b686bc42ee8319efdfc9685c1f-9"></a><span class="go">render_archive</span>
<a name="rest_code_005d96b686bc42ee8319efdfc9685c1f-10"></a><span class="go">render_galleries</span>
<a name="rest_code_005d96b686bc42ee8319efdfc9685c1f-11"></a><span class="go">render_galleries_clean</span>
<a name="rest_code_005d96b686bc42ee8319efdfc9685c1f-12"></a><span class="go">render_indexes</span>
<a name="rest_code_005d96b686bc42ee8319efdfc9685c1f-13"></a><span class="go">render_listings</span>
<a name="rest_code_005d96b686bc42ee8319efdfc9685c1f-14"></a><span class="go">render_pages</span>
<a name="rest_code_005d96b686bc42ee8319efdfc9685c1f-15"></a><span class="go">render_posts</span>
<a name="rest_code_005d96b686bc42ee8319efdfc9685c1f-16"></a><span class="go">render_rss</span>
<a name="rest_code_005d96b686bc42ee8319efdfc9685c1f-17"></a><span class="go">render_site</span>
<a name="rest_code_005d96b686bc42ee8319efdfc9685c1f-18"></a><span class="go">render_sources</span>
<a name="rest_code_005d96b686bc42ee8319efdfc9685c1f-19"></a><span class="go">render_tags</span>
<a name="rest_code_005d96b686bc42ee8319efdfc9685c1f-20"></a><span class="go">sitemap</span>
</pre><p>These have access to the <tt class="docutils literal">site</tt> object which contains your timeline and
your configuration.</p>
<p>The critical bit of Task plugins is their <tt class="docutils literal">gen_tasks</tt> method, which <tt class="docutils literal">yields</tt>
<a class="reference external" href="http://pydoit.org/tasks.html">doit tasks</a>.</p>
<p>The details of how to handle dependencies, etc., are a bit too much for this
document, so I'll just leave you with an example, the <tt class="docutils literal">copy_assets</tt> task.
First the <tt class="docutils literal">task_copy_assets.plugin</tt> file, which you should copy and edit
in the logical ways:</p>
<pre class="code ini"><a name="rest_code_9381626074f94fbbbb1e0a7eaf22c7f7-1"></a><span class="k">[Core]</span>
<a name="rest_code_9381626074f94fbbbb1e0a7eaf22c7f7-2"></a><span class="na">Name</span> <span class="o">=</span> <span class="s">copy_assets</span>
<a name="rest_code_9381626074f94fbbbb1e0a7eaf22c7f7-3"></a><span class="na">Module</span> <span class="o">=</span> <span class="s">task_copy_assets</span>
<a name="rest_code_9381626074f94fbbbb1e0a7eaf22c7f7-4"></a>
<a name="rest_code_9381626074f94fbbbb1e0a7eaf22c7f7-5"></a><span class="k">[Documentation]</span>
<a name="rest_code_9381626074f94fbbbb1e0a7eaf22c7f7-6"></a><span class="na">Author</span> <span class="o">=</span> <span class="s">Roberto Alsina</span>
<a name="rest_code_9381626074f94fbbbb1e0a7eaf22c7f7-7"></a><span class="na">Version</span> <span class="o">=</span> <span class="s">0.1</span>
<a name="rest_code_9381626074f94fbbbb1e0a7eaf22c7f7-8"></a><span class="na">Website</span> <span class="o">=</span> <span class="s">https://getnikola.com</span>
<a name="rest_code_9381626074f94fbbbb1e0a7eaf22c7f7-9"></a><span class="na">Description</span> <span class="o">=</span> <span class="s">Copy theme assets into output.</span>
</pre><div class="note">
<p class="first admonition-title">Note</p>
<p class="last">If you want to publish your plugin on the Plugin Index, <a class="reference external" href="https://github.com/getnikola/plugins/blob/master/README.md">read
the docs for the Index</a>
(and the .plugin file examples and explanations).</p>
</div>
<p>And the <tt class="docutils literal">task_copy_assets.py</tt> file, in its entirety:</p>
<pre class="code python"><a name="rest_code_49880e4efb014ec783939d09d834f135-1"></a><span class="kn">import</span> <span class="nn">os</span>
<a name="rest_code_49880e4efb014ec783939d09d834f135-2"></a>
<a name="rest_code_49880e4efb014ec783939d09d834f135-3"></a><span class="kn">from</span> <span class="nn">nikola.plugin_categories</span> <span class="kn">import</span> <span class="n">Task</span>
<a name="rest_code_49880e4efb014ec783939d09d834f135-4"></a><span class="kn">from</span> <span class="nn">nikola</span> <span class="kn">import</span> <span class="n">utils</span>
<a name="rest_code_49880e4efb014ec783939d09d834f135-5"></a>
<a name="rest_code_49880e4efb014ec783939d09d834f135-6"></a><span class="c"># Have to inherit Task to be a task plugin</span>
<a name="rest_code_49880e4efb014ec783939d09d834f135-7"></a><span class="k">class</span> <span class="nc">CopyAssets</span><span class="p">(</span><span class="n">Task</span><span class="p">):</span>
<a name="rest_code_49880e4efb014ec783939d09d834f135-8"></a>    <span class="sd">&quot;&quot;&quot;Copy theme assets into output.&quot;&quot;&quot;</span>
<a name="rest_code_49880e4efb014ec783939d09d834f135-9"></a>
<a name="rest_code_49880e4efb014ec783939d09d834f135-10"></a>    <span class="n">name</span> <span class="o">=</span> <span class="s">&quot;copy_assets&quot;</span>
<a name="rest_code_49880e4efb014ec783939d09d834f135-11"></a>
<a name="rest_code_49880e4efb014ec783939d09d834f135-12"></a>    <span class="c"># This yields the tasks</span>
<a name="rest_code_49880e4efb014ec783939d09d834f135-13"></a>    <span class="k">def</span> <span class="nf">gen_tasks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a name="rest_code_49880e4efb014ec783939d09d834f135-14"></a>        <span class="sd">&quot;&quot;&quot;Create tasks to copy the assets of the whole theme chain.</span>
<a name="rest_code_49880e4efb014ec783939d09d834f135-15"></a>
<a name="rest_code_49880e4efb014ec783939d09d834f135-16"></a><span class="sd">        If a file is present on two themes, use the version</span>
<a name="rest_code_49880e4efb014ec783939d09d834f135-17"></a><span class="sd">        from the &quot;youngest&quot; theme.</span>
<a name="rest_code_49880e4efb014ec783939d09d834f135-18"></a><span class="sd">        &quot;&quot;&quot;</span>
<a name="rest_code_49880e4efb014ec783939d09d834f135-19"></a>
<a name="rest_code_49880e4efb014ec783939d09d834f135-20"></a>        <span class="c"># I put all the configurations and data the plugin uses</span>
<a name="rest_code_49880e4efb014ec783939d09d834f135-21"></a>        <span class="c"># in a dictionary because utils.config_changed will</span>
<a name="rest_code_49880e4efb014ec783939d09d834f135-22"></a>        <span class="c"># make it so that if these change, this task will be</span>
<a name="rest_code_49880e4efb014ec783939d09d834f135-23"></a>        <span class="c"># marked out of date, and run again.</span>
<a name="rest_code_49880e4efb014ec783939d09d834f135-24"></a>
<a name="rest_code_49880e4efb014ec783939d09d834f135-25"></a>        <span class="n">kw</span> <span class="o">=</span> <span class="p">{</span>
<a name="rest_code_49880e4efb014ec783939d09d834f135-26"></a>            <span class="s">&quot;themes&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">THEMES</span><span class="p">,</span>
<a name="rest_code_49880e4efb014ec783939d09d834f135-27"></a>            <span class="s">&quot;output_folder&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;OUTPUT_FOLDER&#39;</span><span class="p">],</span>
<a name="rest_code_49880e4efb014ec783939d09d834f135-28"></a>            <span class="s">&quot;filters&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;FILTERS&#39;</span><span class="p">],</span>
<a name="rest_code_49880e4efb014ec783939d09d834f135-29"></a>        <span class="p">}</span>
<a name="rest_code_49880e4efb014ec783939d09d834f135-30"></a>
<a name="rest_code_49880e4efb014ec783939d09d834f135-31"></a>        <span class="n">tasks</span> <span class="o">=</span> <span class="p">{}</span>
<a name="rest_code_49880e4efb014ec783939d09d834f135-32"></a>        <span class="k">for</span> <span class="n">theme_name</span> <span class="ow">in</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;themes&#39;</span><span class="p">]:</span>
<a name="rest_code_49880e4efb014ec783939d09d834f135-33"></a>            <span class="n">src</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">get_theme_path</span><span class="p">(</span><span class="n">theme_name</span><span class="p">),</span> <span class="s">&#39;assets&#39;</span><span class="p">)</span>
<a name="rest_code_49880e4efb014ec783939d09d834f135-34"></a>            <span class="n">dst</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">kw</span><span class="p">[</span><span class="s">&#39;output_folder&#39;</span><span class="p">],</span> <span class="s">&#39;assets&#39;</span><span class="p">)</span>
<a name="rest_code_49880e4efb014ec783939d09d834f135-35"></a>            <span class="k">for</span> <span class="n">task</span> <span class="ow">in</span> <span class="n">utils</span><span class="o">.</span><span class="n">copy_tree</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">):</span>
<a name="rest_code_49880e4efb014ec783939d09d834f135-36"></a>                <span class="k">if</span> <span class="n">task</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
<a name="rest_code_49880e4efb014ec783939d09d834f135-37"></a>                    <span class="k">continue</span>
<a name="rest_code_49880e4efb014ec783939d09d834f135-38"></a>                <span class="n">tasks</span><span class="p">[</span><span class="n">task</span><span class="p">[</span><span class="s">&#39;name&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">task</span>
<a name="rest_code_49880e4efb014ec783939d09d834f135-39"></a>                <span class="n">task</span><span class="p">[</span><span class="s">&#39;uptodate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">task</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;uptodate&#39;</span><span class="p">,</span> <span class="p">[])</span> <span class="o">+</span> \
<a name="rest_code_49880e4efb014ec783939d09d834f135-40"></a>                    <span class="p">[</span><span class="n">utils</span><span class="o">.</span><span class="n">config_changed</span><span class="p">(</span><span class="n">kw</span><span class="p">)]</span>
<a name="rest_code_49880e4efb014ec783939d09d834f135-41"></a>                <span class="n">task</span><span class="p">[</span><span class="s">&#39;basename&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
<a name="rest_code_49880e4efb014ec783939d09d834f135-42"></a>                <span class="c"># If your task generates files, please do this.</span>
<a name="rest_code_49880e4efb014ec783939d09d834f135-43"></a>                <span class="k">yield</span> <span class="n">utils</span><span class="o">.</span><span class="n">apply_filters</span><span class="p">(</span><span class="n">task</span><span class="p">,</span> <span class="n">kw</span><span class="p">[</span><span class="s">&#39;filters&#39;</span><span class="p">])</span>
</pre></div>
<div class="section" id="pagecompiler-plugins">
<h2><a class="toc-backref" href="#id5">PageCompiler Plugins</a></h2>
<p>These plugins implement markup languages, they take sources for posts or pages and
create HTML or other output files. A good example is <a class="reference external" href="https://github.com/getnikola/plugins/tree/master/v7/misaka">the misaka plugin.</a></p>
<p>They must provide:</p>
<dl class="docutils">
<dt><tt class="docutils literal">compile_html</tt></dt>
<dd>Function that builds a file.</dd>
<dt><tt class="docutils literal">create_post</tt></dt>
<dd>Function that creates an empty file with some metadata in it.</dd>
</dl>
<p>If the compiler produces something other than HTML files, it should also implement <tt class="docutils literal">extension</tt> which
returns the preferred extension for the output file.</p>
<p>These plugins can also be used to extract metadata from a file. To do so, the
plugin may implement <tt class="docutils literal">read_metadata</tt> that will return a dict containing the
metadata contained in the file.</p>
</div>
<div class="section" id="restextension-plugins">
<h2><a class="toc-backref" href="#id6">RestExtension Plugins</a></h2>
<p>Implement directives for reStructuredText, see <a class="reference external" href="https://github.com/getnikola/nikola/blob/master/nikola/plugins/compile/rest/media.py">media.py</a> for a simple example.</p>
<p>If your output depends on a config value, you need to make your post record a
dependency on a pseudo-path, like this:</p>
<pre class="code text"><a name="rest_code_64b53d1959134050aa67533d9fdbb496-1"></a>####MAGIC####CONFIG:OPTIONNAME
</pre><p>Then, whenever the <tt class="docutils literal">OPTIONNAME</tt> option is changed in conf.py, the file will be rebuilt.</p>
<p>If your directive depends or may depend on the whole timeline (like the
<tt class="docutils literal"><span class="pre">post-list</span></tt> directive, where adding new posts to the site could make it
stale), you should record a dependency on the pseudo-path
<tt class="docutils literal"><span class="pre">####MAGIC####TIMELINE</span></tt>.</p>
</div>
<div class="section" id="markdownextension-plugins">
<h2><a class="toc-backref" href="#id7">MarkdownExtension Plugins</a></h2>
<p>Implement Markdown extensions, see <a class="reference external" href="https://github.com/getnikola/nikola/blob/master/nikola/plugins/compile/markdown/mdx_nikola.py">mdx_nikola.py</a> for a simple example.</p>
<p>Note that Python markdown extensions are often also available as separate
packages. This is only meant to ship extensions along with Nikola.</p>
</div>
<div class="section" id="signalhandler-plugins">
<h2><a class="toc-backref" href="#id8">SignalHandler Plugins</a></h2>
<p>These plugins extend the <tt class="docutils literal">SignalHandler</tt> class and connect to one or more
signals via <a class="reference external" href="http://pythonhosted.org/blinker/">blinker</a>.</p>
<p>The easiest way to do this is to reimplement <tt class="docutils literal">set_site()</tt> and just connect to
whatever signals you want there.</p>
<p>Currently Nikola emits the following signals:</p>
<dl class="docutils">
<dt><tt class="docutils literal">sighandlers_loaded</tt></dt>
<dd>Right after SignalHandler plugin activation.</dd>
<dt><tt class="docutils literal">initialized</tt></dt>
<dd>When all tasks are loaded.</dd>
<dt><tt class="docutils literal">configured</tt></dt>
<dd>When all the configuration file is processed. Note that plugins are activated before this is emitted.</dd>
<dt><tt class="docutils literal">scanned</tt></dt>
<dd>After posts are scanned.</dd>
<dt><tt class="docutils literal">new_post</tt> / <tt class="docutils literal">new_page</tt></dt>
<dd>When a new post is created, using the <tt class="docutils literal">nikola new_post</tt>/<tt class="docutils literal">nikola new_page</tt> commands.  The signal
data contains the path of the file, and the metadata file (if there is one).</dd>
<dt><tt class="docutils literal">existing_post</tt> / <tt class="docutils literal">existing_page</tt></dt>
<dd>When a new post fails to be created due to a title conflict. Contains the same data as <tt class="docutils literal">new_post</tt>.</dd>
<dt><tt class="docutils literal">deployed</tt></dt>
<dd><p class="first">When the <tt class="docutils literal">nikola deploy</tt> command is run, and there is at least one new
entry/post since <tt class="docutils literal">last_deploy</tt>.  The signal data is of the form:</p>
<pre class="last literal-block">
{
 'last_deploy: # datetime object for the last deployed time,
 'new_deploy': # datetime object for the current deployed time,
 'clean': # whether there was a record of a last deployment,
 'deployed': # all files deployed after the last deploy,
 'undeployed': # all files not deployed since they are either future posts/drafts
}
</pre>
</dd>
</dl>
<p>One example is the <a class="reference external" href="https://github.com/getnikola/plugins/tree/master/v6/deploy_hooks">deploy_hooks plugin.</a></p>
</div>
<div class="section" id="configplugin-plugins">
<h2><a class="toc-backref" href="#id9">ConfigPlugin Plugins</a></h2>
<p>Does nothing specific, can be used to modify the site object (and thus the config).</p>
<p>Put all the magic you want in <tt class="docutils literal">set_site()</tt>, and donâ€™t forget to run the one
from <tt class="docutils literal">super()</tt>. Example  plugin: <a class="reference external" href="https://github.com/getnikola/plugins/tree/master/v7/navstories">navstories</a></p>
</div>
<div class="section" id="postscanner-plugins">
<h2><a class="toc-backref" href="#id10">PostScanner Plugins</a></h2>
<p>Get posts and stories from &quot;somewhere&quot; to be added to the timeline.
The only currently existing plugin of this kind reads them from disk.</p>
</div>
</div>
<div class="section" id="plugin-index">
<h1><a class="toc-backref" href="#id11">Plugin Index</a></h1>
<p>There is a <a class="reference external" href="https://plugins.getnikola.com/">plugin index</a>, which stores all
of the plugins for Nikola people wanted to share with the world.</p>
<p>You may want to read the <a class="reference external" href="https://github.com/getnikola/plugins/blob/master/README.md">README for the Index</a> if you want to
publish your package there.</p>
</div>
<div class="section" id="path-link-resolution-mechanism">
<h1><a class="toc-backref" href="#id12">Path/Link Resolution Mechanism</a></h1>
<p>Any plugin can register a function using <tt class="docutils literal">Nikola.register_path_handler</tt> to
allow resolution of paths and links. These are useful for templates, which
can access them via <tt class="docutils literal">_link</tt>.</p>
<p>For example, you can always get a link to the path for the feed of the &quot;foo&quot; tag
by using <tt class="docutils literal"><span class="pre">_link('tag_rss',</span> 'foo')</tt> or the <tt class="docutils literal"><span class="pre">link://tag_rss/foo</span></tt> URL.</p>
<p>Here's the relevant code from the tag plugin.</p>
<pre class="code python"><a name="rest_code_40d751bbba9a4074a3cbc35a0ab0476b-1"></a><span class="c"># In set_site</span>
<a name="rest_code_40d751bbba9a4074a3cbc35a0ab0476b-2"></a><span class="n">site</span><span class="o">.</span><span class="n">register_path_handler</span><span class="p">(</span><span class="s">&#39;tag_rss&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tag_rss_path</span><span class="p">)</span>
<a name="rest_code_40d751bbba9a4074a3cbc35a0ab0476b-3"></a>
<a name="rest_code_40d751bbba9a4074a3cbc35a0ab0476b-4"></a><span class="c"># And these always take name and lang as arguments and returl a list of</span>
<a name="rest_code_40d751bbba9a4074a3cbc35a0ab0476b-5"></a><span class="c"># path elements.</span>
<a name="rest_code_40d751bbba9a4074a3cbc35a0ab0476b-6"></a><span class="k">def</span> <span class="nf">tag_rss_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">lang</span><span class="p">):</span>
<a name="rest_code_40d751bbba9a4074a3cbc35a0ab0476b-7"></a>    <span class="k">return</span> <span class="p">[</span><span class="n">_f</span> <span class="k">for</span> <span class="n">_f</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;TRANSLATIONS&#39;</span><span class="p">][</span><span class="n">lang</span><span class="p">],</span>
<a name="rest_code_40d751bbba9a4074a3cbc35a0ab0476b-8"></a>                          <span class="bp">self</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;TAG_PATH&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">slugify_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="s">&quot;.xml&quot;</span><span class="p">]</span> <span class="k">if</span>
<a name="rest_code_40d751bbba9a4074a3cbc35a0ab0476b-9"></a>            <span class="n">_f</span><span class="p">]</span>
</pre></div>
<div class="section" id="template-hooks">
<h1><a class="toc-backref" href="#id13">Template Hooks</a></h1>
<p>Plugins can use a hook system for adding stuff into templates.  In order to use
it, a plugin must register itself.  The following hooks currently exist:</p>
<ul class="simple">
<li><tt class="docutils literal">extra_head</tt> (not equal to the config option!)</li>
<li><tt class="docutils literal">body_end</tt> (not equal to the config option!)</li>
<li><tt class="docutils literal">page_header</tt></li>
<li><tt class="docutils literal">menu</tt></li>
<li><tt class="docutils literal">menu_alt</tt> (right-side menu in bootstrap, after <tt class="docutils literal">menu</tt> in base)</li>
<li><tt class="docutils literal">page_footer</tt></li>
</ul>
<p>For example, in order to register a script into <tt class="docutils literal">extra_head</tt>:</p>
<pre class="code python"><a name="rest_code_9689fa94f2e24cadb17a5c33f1d04984-1"></a><span class="c"># In set_site</span>
<a name="rest_code_9689fa94f2e24cadb17a5c33f1d04984-2"></a><span class="n">site</span><span class="o">.</span><span class="n">template_hooks</span><span class="p">[</span><span class="s">&#39;extra_head&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;&lt;script src=&quot;/assets/js/fancyplugin.js&quot;&gt;&#39;</span><span class="p">)</span>
</pre><p>There is also another API available.  It allows use of dynamically generated
HTML:</p>
<pre class="code python"><a name="rest_code_d6705a8316104322a4ddf0c80ccf9685-1"></a><span class="c"># In set_site</span>
<a name="rest_code_d6705a8316104322a4ddf0c80ccf9685-2"></a><span class="k">def</span> <span class="nf">generate_html_bit</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">ftype</span><span class="o">=</span><span class="s">&#39;js&#39;</span><span class="p">):</span>
<a name="rest_code_d6705a8316104322a4ddf0c80ccf9685-3"></a>    <span class="k">return</span> <span class="s">&#39;&lt;script src=&quot;/assets/{t}/{n}.{t}&quot;&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="n">ftype</span><span class="p">)</span>
<a name="rest_code_d6705a8316104322a4ddf0c80ccf9685-4"></a>
<a name="rest_code_d6705a8316104322a4ddf0c80ccf9685-5"></a><span class="n">site</span><span class="o">.</span><span class="n">template_hooks</span><span class="p">[</span><span class="s">&#39;extra_head&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">generate_html_bit</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="s">&#39;fancyplugin&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&#39;js&#39;</span><span class="p">)</span>
</pre><p>The second argument to <tt class="docutils literal">append()</tt> is used to determine whether the function
needs access to the current template context and the site.  If it is set to
<tt class="docutils literal">True</tt>, the function will also receive <tt class="docutils literal">site</tt> and <tt class="docutils literal">context</tt> keyword
arguments.  Example use:</p>
<pre class="code python"><a name="rest_code_ef7ec2792303431ea16ee9a82a920bf3-1"></a><span class="c"># In set_site</span>
<a name="rest_code_ef7ec2792303431ea16ee9a82a920bf3-2"></a><span class="k">def</span> <span class="nf">greeting</span><span class="p">(</span><span class="n">addr</span><span class="p">,</span> <span class="n">endswith</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">site</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
<a name="rest_code_ef7ec2792303431ea16ee9a82a920bf3-3"></a>    <span class="k">if</span> <span class="n">context</span><span class="p">[</span><span class="s">&#39;lang&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;en&#39;</span><span class="p">:</span>
<a name="rest_code_ef7ec2792303431ea16ee9a82a920bf3-4"></a>        <span class="n">greet</span> <span class="o">=</span> <span class="s">u&#39;Hello&#39;</span>
<a name="rest_code_ef7ec2792303431ea16ee9a82a920bf3-5"></a>    <span class="k">elif</span> <span class="n">context</span><span class="p">[</span><span class="s">&#39;lang&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;es&#39;</span><span class="p">:</span>
<a name="rest_code_ef7ec2792303431ea16ee9a82a920bf3-6"></a>        <span class="n">greet</span> <span class="o">=</span> <span class="s">u&#39;Â¡Hola&#39;</span>
<a name="rest_code_ef7ec2792303431ea16ee9a82a920bf3-7"></a>
<a name="rest_code_ef7ec2792303431ea16ee9a82a920bf3-8"></a>    <span class="n">t</span> <span class="o">=</span> <span class="s">u&#39; BLOG_TITLE = {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">site</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s">&#39;BLOG_TITLE&#39;</span><span class="p">](</span><span class="n">context</span><span class="p">[</span><span class="s">&#39;lang&#39;</span><span class="p">]))</span>
<a name="rest_code_ef7ec2792303431ea16ee9a82a920bf3-9"></a>
<a name="rest_code_ef7ec2792303431ea16ee9a82a920bf3-10"></a>    <span class="k">return</span> <span class="s">u&#39;&lt;h3&gt;{greet} {addr}{endswith}&lt;/h3&gt;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">greet</span><span class="o">=</span><span class="n">greet</span><span class="p">,</span> <span class="n">addr</span><span class="o">=</span><span class="n">addr</span><span class="p">,</span>
<a name="rest_code_ef7ec2792303431ea16ee9a82a920bf3-11"></a>    <span class="n">endswith</span><span class="o">=</span><span class="n">endswith</span><span class="p">)</span> <span class="o">+</span> <span class="n">t</span>
<a name="rest_code_ef7ec2792303431ea16ee9a82a920bf3-12"></a>
<a name="rest_code_ef7ec2792303431ea16ee9a82a920bf3-13"></a><span class="n">site</span><span class="o">.</span><span class="n">template_hooks</span><span class="p">[</span><span class="s">&#39;page_header&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">greeting</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="s">u&#39;Nikola Tesla&#39;</span><span class="p">,</span> <span class="n">endswith</span><span class="o">=</span><span class="s">u&#39;!&#39;</span><span class="p">)</span>
</pre></div>
<div class="section" id="shortcodes">
<h1><a class="toc-backref" href="#id14">Shortcodes</a></h1>
<p>Some (hopefully all) markup compilers support shortcodes in these forms:</p>
<pre class="literal-block">
 # one argument called &quot;data&quot; containing &quot;Some text&quot;
</pre>
<p>So, if you are creating a plugin that generates markup, it may be a good idea to register it as a shortcode
in addition of a restructured text directive or markdown extension, thus making it available to all markups.</p>
<p>To implement your own shortcodes from a plugin, you can call <tt class="docutils literal">Nikola.register_shortcode(name, f)</tt> with the following
arguments:</p>
<dl class="docutils">
<dt>name:</dt>
<dd>name of the shortcode (foo in the examples above)</dd>
<dt>f:</dt>
<dd>A function that will handle the shortcode</dd>
</dl>
<p>The shortcode handler should take <em>at least</em> the following named arguments:</p>
<dl class="docutils">
<dt>site:</dt>
<dd>An instance of the Nikola class, to access site state</dd>
<dt>data:</dt>
<dd>If the shortcut is used as opening/closing tags, it will be the text between them, otherwise None</dd>
</dl>
<p>If the shortcode tag has arguments of the form &quot;foo=bar&quot; they will be passed as named arguments. Everything else
will be passed as positional arguments in the function call.</p>
<p>So, for example:</p>
<pre class="literal-block">

</pre>
<p>Will cause a call like this:</p>
<pre class="literal-block">
foo_handler(&quot;bar&quot;, &quot;beep&quot;, baz=&quot;bat&quot;, data=&quot;Some text&quot;, site=whatever)
</pre>
</div>
<div class="section" id="state-and-cache">
<h1><a class="toc-backref" href="#id15">State and Cache</a></h1>
<p>Sometimes your plugins will need to cache things to speed up further actions. Here are the conventions for that:</p>
<ul class="simple">
<li>If it's a file, put it somewhere in <tt class="docutils literal"><span class="pre">`self.site.config['CACHE_FOLDER']`</span></tt> (defaults to <tt class="docutils literal">`cache/`</tt>.</li>
<li>If it's a value, use <tt class="docutils literal">`self.site.cache.set(key, value)`</tt> to set it and <tt class="docutils literal">`self.site.cache.get(key)`</tt> to get it.
The key should be a string, the value should be json-encodable (so, be careful with datetime objects)</li>
</ul>
<p>The values and files you store there can <strong>and will</strong> be deleted sometimes by the user. They should always be
things you can reconstruct without lossage. They are throwaways.</p>
<p>On the other hand, sometimes you want to save something that is <strong>not</strong> a throwaway. These are things that may
change the output, so the user should not delete them. We call that <strong>state</strong>. To save state:</p>
<ul class="simple">
<li>If it's a file, put it somewhere in the working directory. Try not to do that please.</li>
<li>If it's a value, use <tt class="docutils literal">`self.site.state.set(key, value)`</tt> to set it and <tt class="docutils literal">`self.state.cache.get(key)`</tt> to get it.
The key should be a string, the value should be json-encodable (so, be careful with datetime objects)</li>
</ul>
<p>The <tt class="docutils literal">`cache`</tt> and <tt class="docutils literal">`state`</tt> objects are rather simplistic, and that's intentional. They have no default values: if
the key is not there, you will get <tt class="docutils literal">`None`</tt> and like it. They are meant to be both threadsafe, but hey, who can
guarantee that sort of thing?</p>
<p>There are no sections, and no access protection, so let's not use it to store passwords and such. Use responsibly.</p>
</div>
